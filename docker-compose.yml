services:
  mcp-server:
    image: ${IMAGE_NAME:-ghcr.io/step-chen/atlassian-dc-mcp-go}:latest
    # Build the image from the Dockerfile in the current directory
    build: .
    container_name: atlassian-dc-mcp
    # Mount the local config file into the container
    volumes:
      - ./config.yaml:/app/config.yaml:ro
      - ./.env:/app/.env:ro
    # Expose ports (only relevant for HTTP mode)
    ports:
      - "${MCP_PORT:-8090}:${MCP_PORT:-8090}"
    # Environment variables
    environment:
      - MCP_PORT=${MCP_PORT:-8090}
    # Healthcheck to ensure the application is running correctly
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:${MCP_PORT:-8090}/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    # Restart policy
    restart: on-failure